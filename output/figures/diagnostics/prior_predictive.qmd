---
title: "Prior Predictive Simulation"
format: html
---


```{r, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE}
source('R/packages.R')

tar_load(model_prior_list)


plot_prior <- function(mod, xmin, xmax){
  
  # how to sequence data
  seq_d <- seq(xmin, xmax, by = 0.5)
  
  # pull variables from model 
  vars <- colnames(mod$data)[-1]
  nlpars <- sort(unique(unlist(mod$prior$nlpar)))[-1]
  
  allvars <- c(vars, nlpars)
  
  # identify categorical variables 
  #factors <- names(Filter(is.factor,mod$data[-1]))

  # identify numeric variables 
  #numeric <- names(Filter(is.numeric,mod$data[-1]))
  
  figlist <- lapply(allvars, function(x){
    
    df <- data.frame(matrix(ncol=length(allvars),nrow=0, dimnames=list(NULL, allvars)))
    
    colnames(df) <- allvars
    
    df %<>%
      summarise_at(x, ~seq_d) %>%
      bind_rows(df, .) %>%
      #mutate(across(all_of(factors), as.factor)) %>% 
      mutate(across(all_of(allvars), ~ replace(., is.na(.), 0)))
    
    epred <- add_epred_draws(df, mod)
    
    ggplot(epred, aes(x = get(x), y = .epred)) +
      geom_line(aes(group = .draw), alpha = 0.1) +
      labs(y = "Predicted Kill Rate", x = x) +
      theme_classic()
    
  })
}
```

## Prior Predictive Checks

Prior predictive checks are used to ensure that the values selected for priors for our models allow a biologically reasonable range of values. We simulate predictive draws for prior only models and visualize the slope/intercept of the values. We then do a "posterior predictive check" but with the prior only model, to see if the data is captured in the priors.

## Model 1: Vander Vennen Paper 

```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mod <- model_prior_list['VanderVennen_prior']
figs <- plot_prior(mod[[1]], 0, 2)
do.call(grid.arrange, figs)
plot(pp_check(mod[[1]], ndraws = 100))
```
